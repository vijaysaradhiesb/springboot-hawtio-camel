<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cxf="http://camel.apache.org/schema/cxf"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:core="http://cxf.apache.org/core"
       xmlns:http-conf="http://cxf.apache.org/transports/http/configuration"
       xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
            http://camel.apache.org/schema/cxf
            http://camel.apache.org/schema/cxf/camel-cxf.xsd
            http://cxf.apache.org/core
            http://cxf.apache.org/schemas/core.xsd
            http://www.springframework.org/schema/util
            http://www.springframework.org/schema/util/spring-util.xsd
            http://cxf.apache.org/transports/http/configuration
            http://cxf.apache.org/schemas/configuration/http-conf.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context.xsd">

    <context:annotation-config/>
    <context:component-scan base-package="com.spring.boot.hawtio"/>

    <camelContext id="SampleCamel" xmlns="http://camel.apache.org/schema/spring">
        <route id="hello1" autoStartup="false">
            <from uri="timer:hello?period={{timer.period}}"/>
            <transform>
                <method ref="myBean" method="saySomething"/>
            </transform>
            <filter>
                <simple>${body} contains 'foo'</simple>
                <to uri="log:foo"/>
            </filter>

            <to uri="log:foo"/>
        </route>

        <route id="hello2">
            <from uri="cxfrs:bean:restService?bindingStyle=Default"/>
            <log message="******************** invoked *********************"/>
            <setExchangePattern pattern="InOut"/>

            <choice>
            <when>
            <simple>${header.operationName} == 'getDetails'</simple>

            <convertBodyTo type="com.spring.boot.camel.example.Student"/>
            <to uri="validator:/src/main/resources/xsd/test.xsd"/>

            </when>
            </choice>

            <transform>
                <method ref="myBean" method="returnSomething"/>
            </transform>
            <!--<to uri="log:out"/>-->
        </route>

    </camelContext>

    <cxf:rsServer id="restService" address="${esb.service.address}"
                  serviceClass="com.spring.boot.hawtio.SimpleService"
                  bus="gatewayCxfBus">
        <cxf:providers>
            <ref bean="jacksonJaxbJsonProvider"/>
        </cxf:providers>
        <cxf:features>
            <core:logging/>
            <bean class="org.apache.cxf.transport.common.gzip.GZIPFeature"/>
        </cxf:features>

    </cxf:rsServer>

    <core:bus bus="gatewayCxfBus">
        <core:properties>
            <entry key="skip.default.json.provider.registration" value="true"/>
        </core:properties>
    </core:bus>

    <bean id="objectMapper" class="com.fasterxml.jackson.databind.ObjectMapper"/>
    <bean id="jacksonJaxbJsonProvider" class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider">
        <constructor-arg ref="objectMapper"/>
    </bean>

</beans>
